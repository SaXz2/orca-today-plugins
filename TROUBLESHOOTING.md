# Today插件故障排除指南

## 问题：需要手动设置date属性才生效

### 问题描述
您可能遇到Today插件需要手动设置date属性才能正常工作的情况。

### 原因分析
这个问题通常由以下原因造成：

1. **Today标签没有正确创建为属性引用**
   - Orca Note中的标签可能只是简单的文本标签，而不是属性引用
   - 插件需要属性引用才能设置date属性

2. **属性引用结构不完整**
   - Today标签存在但没有正确的数据结构
   - 缺少必要的属性引用类型

### 解决方案

#### 方案1：使用改进版插件（推荐）
新版本的插件已经包含了强制创建Today属性引用的功能：

1. **强制创建属性结构**：插件会自动检测没有Today属性引用的块
2. **明确指定类型**：创建date属性时明确指定类型为"date"
3. **多种创建方法**：如果一种方法失败，会尝试其他方法
4. **完整属性结构**：确保Today标签有完整的属性引用和date属性

**新功能特点：**
- 自动检测并创建Today属性引用
- **强制创建date属性**：如果没有date属性，强制创建日期类型
- **类型强制转换**：如果date属性不是日期类型，强制转换为日期类型
- **多重创建方法**：使用多种方法确保创建成功
- **专门的强制创建函数**：`forceCreateDateProperty()` 专门处理强制创建
- 详细的调试日志帮助排查问题

#### 方案2：手动设置date属性
如果自动创建不工作，可以手动设置：

1. 在带有 `#Today` 标签的块上
2. 右键点击或使用命令面板
3. 选择"设置属性"或类似选项
4. 添加 `date` 属性，值为当前日期

#### 方案3：检查标签格式
确保Today标签格式正确：

```
# 正确的格式
- [ ] 任务1 #Today
- [ ] 任务2 #Today

# 错误的格式（可能不工作）
- [ ] 任务1 #today
- [ ] 任务2 #TODAY
- [ ] 任务3 # Today
```

### 调试步骤

1. **查看控制台日志**
   - 打开开发者工具（F12）
   - 查看控制台输出
   - 寻找详细的调试信息

2. **检查块结构**
   - 查看块的refs属性
   - 确认Today标签是否正确创建为属性引用

3. **手动触发更新**
   - 使用命令面板执行"更新Today标签的日期属性"
   - 观察控制台输出

### 预期行为

正常工作的插件应该：

1. **自动检测**：找到所有带有Today标签的块
2. **强制创建Today属性引用**：为没有属性引用的块强制创建Today属性引用
3. **强制创建date属性**：如果没有date属性，强制创建日期类型的date属性
4. **强制类型转换**：如果date属性不是日期类型，强制转换为日期类型
5. **自动更新**：设置或更新date属性为当前日期
6. **定时更新**：每小时自动检查并更新
7. **多重保障**：使用专门的 `forceCreateDateProperty()` 函数确保创建成功

### 常见错误信息

- `块 xxx 没有Today属性引用，强制创建完整的属性结构...` - 正常，插件会强制创建
- `块 xxx 没有date属性，强制创建日期类型的date属性` - 正常，插件会强制创建
- `块 xxx date属性类型不正确: xxx，强制更新为date类型` - 正常，插件会强制转换
- `强制为块 xxx 创建日期类型的date属性` - 正常，使用专门的强制创建函数
- `成功为块 xxx 创建日期类型的date属性（方法1/方法2）` - 成功创建
- `为块 xxx 强制创建date属性失败` - 需要检查权限或API调用
- `更新块 xxx 时出错` - 可能是权限或数据格式问题

### 联系支持

如果问题仍然存在，请提供：
1. 控制台的完整错误日志
2. 块的数据结构示例
3. Orca Note的版本信息
4. 插件的版本信息
